# Oxc 源码深入学习路线（逐步计划）

说明
我已经阅读了仓库根 README 和各个 crate 的 README（parser、syntax、ast、semantic、allocator、cfg、codegen、language_server 等），并把「逐步深入的学习路线」整理成以下可执行的 Markdown 学习计划。下面是一份分阶段的路线、每阶段目标、具体任务与练习、常用命令和参考资料，便于你系统化地深刻理解 oxc 的实现原理并上手源码贡献。

---

## 快速索引
- 阶段 A：快速建立全局认知（0.5–1 天）
- 阶段 B：解析器与 AST（1–3 天）
- 阶段 C：内存管理与性能（1–2 天）
- 阶段 D：语义分析（2–4 天）
- 阶段 E：控制流 / Linter / 高级分析（2–4 天）
- 阶段 F：集成、Language Server 与 N-API（1–2 天）
- 工具与常用命令
- 阅读源码时的技巧
- 推荐背景资料与书籍
- 可选后续任务（练习 / 贡献建议）

---

## 阶段 A — 快速建立全局认知（0.5–1 天）
目标：理解项目目的、模块边界、构建和运行方式。

任务：
- 阅读项目根 README、ARCHITECTURE.md（若存在）、各 crate 的 README（oxc_parser、oxc_ast、oxc_semantic、oxc_allocator、oxc_cfg、oxc_codegen、oxc_language_server 等）。
- 本地编译并运行基础测试。

常用命令：
- git clone https://github.com/oxc-project/oxc
- cd oxc
- cargo build --workspace
- cargo test --workspace
- cargo doc --workspace --open

检查点：
- 能运行构建命令且无阻塞错误。
- 能找到 parser、semantic、allocator 相关 crate 的 README 并理解其职责。

---

## 阶段 B — 理解解析器与 AST（1–3 天）
目标：掌握 tokenization、解析策略（递归下降）、AST 结构与错误恢复机制。

优先阅读：
- crates/oxc_syntax（syntax 定义、token 常量）
- crates/oxc_span（位置/Span 管理）
- crates/oxc_parser（Parser 实现）
- crates/oxc_ast（AST 节点定义）

任务与练习：
- 在仓库中查找 Parser 的入口（例如 struct/impl Parser），阅读其 parse 流程。
- 使用库 API 将一个简单 JS/TS 文件 parse 为 AST 并打印（参考根 README 示例）。
- 在 parser 的关键位置插入日志（或用调试器）观察 token 流和错误恢复。
- 理解 AST 节点如何记录位置信息（span/position）以及节点分配策略（与 allocator 的关联）。

定位命令：
- rg "struct Parser|impl Parser" -S
- rg "Token|Span|Position" -S

检查点：
- 能用 API 解析样例文件并看到 AST（或其序列化）。
- 能理解并描述解析器如何处理一个简单语法错误（错误恢复步骤）。

---

## 阶段 C — 内存管理与性能（1–2 天）
目标：理解 arena / bump allocator 的设计与性能收益，以及 AllocatorPool 的复用策略。

优先阅读：
- crates/oxc_allocator README 与实现（src/lib.rs、src/pool.rs）

任务与练习：
- 阅读 Allocator、AllocatorPool 的实现，理解为什么使用 arena。
- 对比解析大量文件时启用 arena 与不启用的内存与时间开销（写简单 benchmark）。
- 理解 pool 的线程安全实现（Mutex/Arc）以及 fixed_size / pool 特性。

检查点：
- 能解释 arena 分配的基本原理（快速分配、统一释放）。
- 能描述 AllocatorPool 是如何通过复用减少分配开销的。

---

## 阶段 D — 语义分析（2–4 天）
目标：掌握符号表、作用域、引用解析、模块解析与 SemanticBuilder 的实现。

优先阅读：
- crates/oxc_semantic README 与 src 中的 SemanticBuilder、scope、symbol、reference 等实现。

任务与练习：
- 找到 SemanticBuilder 的入口（构建步骤），了解它如何访问 AST 并填充语义信息。
- 在 parsed AST 上运行语义构建并打印符号表、未定义的引用、导出/导入信息。
- 尝试做一个简单的代码改造（例如重命名识别符），验证语义信息对改造的影响。

定位命令：
- rg "SemanticBuilder" -S
- rg "struct .*Scope|struct .*Symbol" -S

检查点：
- 能解释作用域链的构建过程、引用解析如何定位定义以及 module resolution 的基本流程。

---

## 阶段 E — 控制流、分析与 Lint（2–4 天）
目标：理解 CFG 的构造与用途，掌握 linter 规则如何利用 AST 与语义信息生成诊断。

优先阅读：
- crates/oxc_cfg（CFG 构建/分析）
- linter 相关 crate 或模块（如果有）
- crates/oxc_language_server（查看如何把 lint 集成到 LSP）

任务与练习：
- 在函数/方法上生成 CFG，打印基本块与边，尝试识别死代码或简单的数据流分析问题。
- 阅读并实现或修改一个简单的 lint 规则（例如检测未使用变量或特定样式问题）。
- 使用 linter 运行在一个中等规模代码库，观察性能与诊断输出。

检查点：
- 能生成并理解一个函数的基本 CFG。
- 能实现并测试一个最小 lint rule。

---

## 阶段 F — 集成与运维（1–2 天）
目标：了解如何把库打包并以 Language Server、N-API 或 CLI 形式暴露给外部。

优先阅读：
- crates/oxc_language_server（tokio、LSP 逻辑）
- crates/oxc_napi（Node JS 接口）
- 根 oxc crate（如何组合各模块）

任务与练习：
- 本地运行 language server（或用现成编辑器连接），观察文件打开/更改时的行为。
- 用 oxc_napi 将解析功能暴露给一个简单 Node 脚本（若你对 N-API 感兴趣）。
- 阅读 Server 代码（tokio runtime、async 锁使用）并理解并发模型。

检查点：
- 能运行 language server 并观察到 lint/diagnostics 的触发。
- 能描述 tokio + async RwLock/Mutex 在该项目中的角色。

---

## 阅读源码时的具体技巧与常用命令
- 全库搜索定位：
  - rg "struct Parser" -S
  - rg "SemanticBuilder" -S
  - rg "Allocator::default|struct Allocator" -S
- 生成文档并查看 public API 注释：
  - cargo doc --workspace --open
- 运行单元测试 / 特定 crate 测试：
  - cargo test -p <crate_name>
- 调试：
  - 在关键函数加入 log/println!，或用 lldb/gdb/rust-gdb/rust-lldb 配合断点调试。

---

## 推荐背景资料（书籍 / 文章 / 项目）
- ECMAScript 规范（了解语法细节）
- 编译原理与解析：
  - Crafting Interpreters（尤适合解析器与 AST 学习）
  - Dragon Book（深入编译器理论）
- Rust 相关：
  - The Rust Programming Language（所有权、生命周期、智能指针）
  - Rust async/await 与 tokio 文档（用于理解 LSP 的并发模型）
- 参考项目：
  - swc（另一个 Rust 实现的 JS/TS 工具链）
  - esbuild（核心思想、codegen 策略）

---

## 练习与贡献建议（可选）
- 练习 1：实现并提交一个小型 lint 规则（从阅读现有规则开始，按贡献指南开 PR）。
- 练习 2：为 parser 添加一个测试用例，覆盖某个边界语法并验证 AST/语义输出。
- 练习 3：优化 allocator 或 pool 小段代码并提交性能基准（务必提供基准结果）。

---

## 时间表（示例）
- 第 1 天：完成阶段 A 与 B 的核心阅读并能跑起解析 demo。
- 第 2–3 天：深入 parser、AST、allocator；完成简单 benchmark。
- 第 4–6 天：语义分析与 CFG 实验，完成一个小 lint。
- 第 7 天：阅读 language server、N-API，准备第一个 PR（小改动或测试）。

---

## 我已为你做了什么，以及接下来我能做的事
我已经把仓库的核心 README 与各 crate 的架构说明整理并抽取要点，基于这些内容设计出上面的分阶段学习路线（含任务、命令与练习）。
如果你愿意，我可以马上为你做下一步：把“阶段 B（解析器）”内最关键的文件和函数逐个列出来并贴出代码片段讲解；或者把一个具体练习（例如“用 oxc 解析并打印 AST 的示例程序”）写成可运行的代码示例给你。你想先看哪一个？
